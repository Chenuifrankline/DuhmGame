package codegenerator.templates

import codegenerator.CodegenInterface
import codegenerator.Template
import org.eclipse.uml2.uml.Operation
import org.eclipse.uml2.uml.ParameterDirectionKind
import org.eclipse.uml2.uml.OpaqueBehavior

class OperationTemplate implements Template<Operation> {

	override generateCode(CodegenInterface it, Operation umlOperation, String context) {
		// TODO: Aufgabe 2
		// variables pour les paramètres et les constantes
		var type = "void"

		val name = generate(umlOperation, "name")
		var const = " const me" // Variable constante fictive
		var param = !umlOperation.isStatic ? generate(umlOperation.class_, "type") + const : ""
	val klasse = umlOperation.class_
	val params = umlOperation.ownedParameters
	val isStatic = umlOperation.isStatic

	val returnParam = params.findFirst[direction == ParameterDirectionKind.RETURN_LITERAL]
	val returnType = if (returnParam !== null) it.generate(returnParam, "return") else "void"
	val inputParams = params.filter[direction != ParameterDirectionKind.RETURN_LITERAL]

	val paramString = inputParams.join(", ") [ p | it.generate(p, "parameter") ]

	val prefix = if (klasse.package !== null)
		'''«it.generate(klasse.package, "name")»_«klasse.name»'''
	else
		klasse.name

var paramList = ""
		if (!isStatic) {
			paramList = prefix + "* const me"
			if (!paramString.empty) {
				paramList = paramList + ", " + paramString
			}
		} else {
			paramList = if(!paramString.empty) paramString else "void"
		}


		var finalName = '''«returnType» «prefix»_«name»(«paramList»);'''

		return finalName
	}
}