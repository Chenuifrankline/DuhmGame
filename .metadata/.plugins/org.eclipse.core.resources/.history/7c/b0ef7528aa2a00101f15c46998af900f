package codegenerator.templates

import codegenerator.CodegenInterface
import codegenerator.Template
import org.eclipse.uml2.uml.StructuredClassifier

class StructuredClassifierTemplate implements Template<StructuredClassifier> {

	override generateCode(CodegenInterface it, StructuredClassifier umlClassifier, String context) {
		// TODO: Aufgabe 2
	
		val name = if (umlClassifier.package !== null)
				it.generate(umlClassifier.package, "name") + "_" + umlClassifier.name
			else
				umlClassifier.name

		val attributes = umlClassifier.ownedAttributes.map [ attr |
			var typeName = attr.type.name
			if (attr.type.package !== null) {
				typeName = it.generate(attr.type.package, "name") + "_" + typeName
			}
			// Adjust handling for array and pointer types
			if (attr.upper == -1) {
				typeName + "* " + attr.name + ";"
			} else if (attr.upper > 1) {
				typeName + "* " + attr.name + ";"
			} else {
				typeName + " " + attr.name + ";"
			}
		].join("\n") 
		
		return if (attributes.empty)
			'''typedef struct «name»_struct {
} «name»;
'''
		else
			'''typedef struct «name»_struct {
	«attributes»
} «name»;
'''
	}
}
