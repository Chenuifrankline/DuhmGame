package codegenerator.templates

import codegenerator.CodegenInterface
import codegenerator.Template
import org.eclipse.uml2.uml.StructuredClassifier

class StructuredClassifierTemplate implements Template<StructuredClassifier> {

	override generateCode(CodegenInterface it, StructuredClassifier umlClassifier, String context) {
		// TODO: Aufgabe 2
		// Generiere den Namen des strukturierten Klassifizierers
		val nameTemplate = new NameTemplate()
		val generatedName = nameTemplate.generateCode(it, umlClassifier, "name")
		
		// Zeichenkette für die Attribute
		var str = ""
		
		// Durchlaufe die Attribute des strukturierten Klassifizierers
		for (var i = 0; i < umlClassifier.ownedAttributes.length; i++) {
			val attr = umlClassifier.ownedAttributes.get(i)
			var typeName = attr.type.name
			
			// Falls das Attribut einen Package-Namen hat, füge diesen hinzu
			if (attr.type.package !== null) {
				typeName = generate(attr.type.package, "name") + "_" + typeName
			}
			
			// Falls das Attribut ein Array ist (upper > 1), generiere den C-Code für ein Array
			if (attr.upper == -1) {
				// Zeiger (Pointer) für unbestimmte Größen
				str += "\n    " + typeName + "* " + attr.name + ";"
			} else if (attr.upper > 1) {
				// Array mit fester Größe
				str += "\n    " + typeName + " " + attr.name + "[" + attr.upper + "];"
			} else {
				// Einfaches Attribut ohne Array oder Pointer
				str += "\n    " + typeName + " " + attr.name + ";"
			}
		}
		
		// Gib den Code für die Struktur mit ihren Attributen zurück
		if (str.isEmpty) {
			return '''typedef struct «generatedName»_struct {
} «generatedName»;'''
		} else {
			return '''typedef struct «generatedName»_struct {«str»
} «generatedName»;'''
		}
	}
}
